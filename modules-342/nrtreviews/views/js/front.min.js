$(document).ready(function(){function o(){$(".js-review-fulness").each(function(){var e=$(this),s=e.data("id-review");void 0!==opReviews.fulness[s]?($(".js-review-fulness-"+s).removeClass("active_color"),(Boolean(opReviews.fulness[s])?$(".js-review-fulness-"+s+'[data-value="1"]'):$(".js-review-fulness-"+s+'[data-value="0"]')).addClass("active_color")):e.removeClass("active_color")})}function e(){var o=[];$(".js-review-avgs").each(function(){var e=$(this),s=0;e.closest(".js-product-miniature").length?s=e.closest(".js-product-miniature").data("id-product"):$("#product_page_product_id").length&&(s=$("#product_page_product_id").val()),e.attr("data-id-product",s),o.includes(s)||o.push(s)}),o.length<1||$.post(opReviews.actions,{process:"avg",ajax:1,listIds:o},null,"json").then(function(e){e.success&&$.each(e.products,function(e,s){var o=$(".js-review-avgs[data-id-product="+s.id_product+"]");0<s.avgReviews.nbr&&(o.find(".star_content_avg").html('<span style="width:'+s.avgReviews.avg/5*100+'%"></span>'),o.find(".r-nbr").html(s.avgReviews.nbr),o.removeClass("hidden"))})}).fail(function(e){prestashop.emit("handleError",{eventType:"reviewUpdateAvgs",resp:e})})}o(),e(),$("body").on("show.bs.modal",".quickview",function(){e()}),prestashop.on("updatedProductList",function(){e()}),prestashop.on("updatedProductAjax",function(){e()}),$("#reviews_form form").on("submit",function(e){prestashop.emit("postReviewProduct",{data:new FormData(this)}),e.preventDefault()}),$("body").on("click",".js-review-fulness",function(e){prestashop.emit("postReviewFulness",{dataset:this.dataset,self:this}),e.preventDefault()}),prestashop.on("postReviewFulness",function(s){var e;$(".js-review-fulness-"+s.dataset.idReview).hasClass("rv-processing")||(e={process:"fulness",ajax:1,idReview:s.dataset.idReview,value:s.dataset.value},$(".js-review-fulness-"+s.dataset.idReview).addClass("rv-processing"),$.post(opReviews.actions,e,null,"json").then(function(e){e.success&&($("#js-fulness-text-"+s.dataset.idReview).text(e.is_fulness),$("#js-nofulness-text-"+s.dataset.idReview).text(e.no_fulness),opReviews.fulness=e.fulness,o()),$(".js-review-fulness-"+s.dataset.idReview).removeClass("rv-processing")}).fail(function(e){prestashop.emit("handleError",{eventType:"postReviewFulness",resp:e})}))}),prestashop.on("postReviewProduct",function(e){$("#reviews_form form").hasClass("rv-processing")||($("#reviews_form form").addClass("rv-processing"),$("#reviews_form_btn button").addClass("processing"),$("#reviews_form_error").hide(),$("#reviews_form_error").html(""),$.ajax({url:opReviews.actions+"?process=add",data:e.data,type:"POST",headers:{"cache-control":"no-cache"},dataType:"json",contentType:!1,processData:!1,complete:function(){prestashop.emit("submitCompleteNrtForm",null)},success:function(e){e.is_logged?($("#reviews_form form").removeClass("rv-processing"),$("#reviews_form_btn button").removeClass("processing"),e.success?(alert(e.msg),e.reload&&window.location.reload()):($.each(e.errors,function(e,s){$("#reviews_form_error").append("<div>"+s+"</div>")}),$("#reviews_form_error").slideDown())):(e={process:"login",ajax:1,current_url:prestashop.urls.current_url},$.post(opReviews.login,e,null,"json").then(function(e){$("#reviews_login").html(e.html),$("#modal_reviews").modal("show"),$("#reviews_form form").removeClass("rv-processing"),$("#reviews_form_btn button").removeClass("processing")}).fail(function(e){prestashop.emit("handleError",{eventType:"reviewsShowLogin",resp:e})}))}}))}),$("body").on("click","#main-content .open-review-form",function(e){prestashop.emit("goToCommentForm",null),e.preventDefault()}),$("body").on("click","#main-content .goto-product-review-tab",function(e){prestashop.emit("goToCommentTab",null),e.preventDefault()}),$("body").on("click",".js-comment-pn",function(){var e={process:"comments",ajax:1,id_product:$(this).data("id-product"),page:$(this).data("page")};$("html, body").animate({scrollTop:$("#reviews-list-comments").offset().top-100},0,"linear"),$("#reviews-list-comments-item").html('<div class="placeholder-load-spin">Load more</div><hr>'),$.post(opReviews.actions,e,null,"json").then(function(e){$("#reviews-list-comments").html(e.html),prestashop.emit("updatedReviewsAjax",null)})})});